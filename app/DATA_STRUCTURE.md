# üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞

## –û–±–∑–æ—Ä

–í—Å—è –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –≤ –ø–∞–ø–∫–µ `data/`:

```
fitbud_bot/
‚îú‚îÄ‚îÄ data/                    # –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ (–Ω–µ –≤ Git!)
‚îÇ   ‚îú‚îÄ‚îÄ postgres/           # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
‚îÇ   ‚îî‚îÄ‚îÄ media/              # –ú–µ–¥–∏–∞-—Ñ–∞–π–ª—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ       ‚îú‚îÄ‚îÄ voice/          # –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (.ogg)
‚îÇ       ‚îî‚îÄ‚îÄ photos/         # –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –µ–¥—ã (.jpg)
‚îú‚îÄ‚îÄ backups/                # –ë—ç–∫–∞–ø—ã –ë–î (–Ω–µ –≤ Git!)
‚îî‚îÄ‚îÄ ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–∞–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

‚úÖ **–ü–æ—Ä—Ç–∞—Ç–∏–≤–Ω–æ—Å—Ç—å** - –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–∞–ø–∫—É –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä
‚úÖ **–ü—Ä–æ—Å—Ç–æ–π –±—ç–∫–∞–ø** - –≤—Å—è –ë–î –≤ –æ–¥–Ω–æ–π –ø–∞–ø–∫–µ
‚úÖ **–õ–µ–≥–∫–æ –Ω–∞–π—Ç–∏** - –¥–∞–Ω–Ω—ã–µ –Ω–µ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ —Å–∏—Å—Ç–µ–º–µ
‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å** - –≤–∏–¥–Ω–æ —Å–∫–æ–ª—å–∫–æ –º–µ—Å—Ç–∞ –∑–∞–Ω–∏–º–∞—é—Ç –¥–∞–Ω–Ω—ã–µ
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ data/

## –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

### data/postgres/
**–ß—Ç–æ:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL —Å–æ –≤—Å–µ–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏

**–†–∞–∑–º–µ—Ä:** ~10-50 MB –Ω–∞ 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏)

**–í–∞–∂–Ω–æ:** 
- –ù–ï —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –≤—Ä—É—á–Ω—É—é!
- –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ psql –∏–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- –î–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ pg_dump/pg_restore

### data/media/voice/
**–ß—Ç–æ:** –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ .ogg

**–†–∞–∑–º–µ—Ä:** ~20-50 KB –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ

**–§–æ—Ä–º–∞—Ç:** `{user_id}_{timestamp}.ogg`

**–û—á–∏—Å—Ç–∫–∞:** –ú–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã (>30 –¥–Ω–µ–π)

### data/media/photos/
**–ß—Ç–æ:** –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –µ–¥—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ .jpg

**–†–∞–∑–º–µ—Ä:** ~50-200 KB –Ω–∞ —Ñ–æ—Ç–æ

**–§–æ—Ä–º–∞—Ç:** `{user_id}_{timestamp}.jpg`

**–û—á–∏—Å—Ç–∫–∞:** –ú–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã

### backups/
**–ß—Ç–æ:** SQL –¥–∞–º–ø—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–§–æ—Ä–º–∞—Ç:** `backup_YYYYMMDD_HHMMSS.sql`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
make backup

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
cat backups/backup_20250210_120000.sql | docker compose exec -T postgres psql -U fitbud_user -d fitbud_bot
```

## –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

```bash
./docker-deploy.sh
# –∏–ª–∏
./init-dirs.sh
```

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
data/
‚îú‚îÄ‚îÄ postgres/           # –°–æ–∑–¥–∞–µ—Ç—Å—è Docker –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
‚îÇ   ‚îú‚îÄ‚îÄ base/
‚îÇ   ‚îú‚îÄ‚îÄ global/
‚îÇ   ‚îú‚îÄ‚îÄ pg_wal/
‚îÇ   ‚îî‚îÄ‚îÄ ... (—Ñ–∞–π–ª—ã PostgreSQL)
‚îî‚îÄ‚îÄ media/
    ‚îú‚îÄ‚îÄ voice/         # –°–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≥–æ–ª–æ—Å–æ–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
    ‚îî‚îÄ‚îÄ photos/        # –°–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
```

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–º

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö

```bash
# –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä
du -sh data/

# –ü–æ –ø–∞–ø–∫–∞–º
du -sh data/*/

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
docker compose exec postgres du -sh /var/lib/postgresql/data

# –ú–µ–¥–∏–∞-—Ñ–∞–π–ª—ã
du -sh data/media/*/
```

### –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –º–µ–¥–∏–∞

–°–æ–∑–¥–∞–π—Ç–µ cron-–∑–∞–¥–∞—á—É –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏:

```bash
# –û—á–∏—Å—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
find data/media/voice/ -type f -mtime +30 -delete
find data/media/photos/ -type f -mtime +30 -delete
```

–ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ crontab:
```bash
# –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00
0 3 * * * find /opt/fitbud_bot/data/media/voice/ -type f -mtime +30 -delete
0 3 * * * find /opt/fitbud_bot/data/media/photos/ -type f -mtime +30 -delete
```

## –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–π –±—ç–∫–∞–ø

```bash
# –ë–î
make backup

# –í—Å—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è data
tar -czf fitbud_backup_$(date +%Y%m%d).tar.gz data/
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø (cron)

```bash
crontab -e
```

–î–æ–±–∞–≤—å—Ç–µ:
```bash
# –ë—ç–∫–∞–ø –ë–î –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00
0 2 * * * cd /opt/fitbud_bot && docker compose exec postgres pg_dump -U fitbud_user fitbud_bot > backups/backup_$(date +\%Y\%m\%d_\%H\%M\%S).sql

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ (>7 –¥–Ω–µ–π)
0 4 * * * find /opt/fitbud_bot/backups/ -name "backup_*.sql" -mtime +7 -delete
```

### –û–±–ª–∞—á–Ω—ã–π –±—ç–∫–∞–ø

```bash
# rclone –≤ Google Drive
rclone sync /opt/fitbud_bot/backups/ gdrive:fitbud_backups/

# rsync –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
rsync -avz /opt/fitbud_bot/data/ backup-server:/backups/fitbud/
```

## –ü–µ—Ä–µ–Ω–æ—Å –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ data/

```bash
# –ù–∞ —Å—Ç–∞—Ä–æ–º —Å–µ—Ä–≤–µ—Ä–µ
cd /opt/fitbud_bot
docker compose down
tar -czf fitbud_data.tar.gz data/

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –Ω–∞ –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä
scp fitbud_data.tar.gz new-server:/opt/fitbud_bot/

# –ù–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ
cd /opt/fitbud_bot
tar -xzf fitbud_data.tar.gz
docker compose up -d
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –î–∞–º–ø –ë–î

```bash
# –°—Ç–∞—Ä—ã–π —Å–µ—Ä–≤–µ—Ä - —Å–æ–∑–¥–∞—Ç—å –¥–∞–º–ø
docker compose exec postgres pg_dump -U fitbud_user fitbud_bot > full_backup.sql

# –ù–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
cat full_backup.sql | docker compose exec -T postgres psql -U fitbud_user -d fitbud_bot
```

## –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø—Ä–∞–≤–∞:

```bash
# –í–ª–∞–¥–µ–ª–µ—Ü - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–º —Ä–∞–±–æ—Ç–∞–µ—Ç Docker
sudo chown -R $USER:$USER data/ backups/

# –ü—Ä–∞–≤–∞
chmod -R 755 data/
chmod -R 755 backups/

# PostgreSQL –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø
# (Docker –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ä–∞–∑–º–µ—Ä–æ–º

```bash
# –°–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
#!/bin/bash
SIZE=$(du -sm data/ | cut -f1)
if [ $SIZE -gt 1000 ]; then
    echo "‚ö†Ô∏è  –†–∞–∑–º–µ—Ä data/ –ø—Ä–µ–≤—ã—Å–∏–ª 1GB: ${SIZE}MB"
fi
```

### –ê–ª–µ—Ä—Ç—ã –Ω–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∏—Å–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
df -h /opt/fitbud_bot/data/
```

## –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ—è

### –ï—Å–ª–∏ –ë–î –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose down

# 2. –£–¥–∞–ª–∏—Ç–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
rm -rf data/postgres/*

# 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ –±—ç–∫–∞–ø–∞
docker compose up -d postgres
sleep 10
cat backups/backup_latest.sql | docker compose exec -T postgres psql -U fitbud_user -d fitbud_bot

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
docker compose up -d bot
```

### –ï—Å–ª–∏ –ø–æ—Ç–µ—Ä—è–Ω—ã –º–µ–¥–∏–∞

–ú–µ–¥–∏–∞-—Ñ–∞–π–ª—ã –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã:
- AI –∞–Ω–∞–ª–∏–∑ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î
- –ú–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç—ã–µ –ø–∞–ø–∫–∏:

```bash
mkdir -p data/media/voice data/media/photos
```

## .gitignore

–î–∞–Ω–Ω—ã–µ –ù–ï –¥–æ–ª–∂–Ω—ã –ø–æ–ø–∞–¥–∞—Ç—å –≤ Git:

```gitignore
# –í .gitignore —É–∂–µ –µ—Å—Ç—å:
data/
backups/
```

–ù–æ –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
```bash
git add data/.gitkeep
git add backups/.gitkeep
```

## FAQ

**Q: –ú–æ–∂–Ω–æ –ª–∏ —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ Docker volume?**
A: –î–∞, –Ω–æ —Ç–æ–≥–¥–∞ —Å–ª–æ–∂–Ω–µ–µ –¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø—ã –∏ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.

**Q: –ö–∞–∫ —É–∑–Ω–∞—Ç—å —Å–∫–æ–ª—å–∫–æ –º–µ—Å—Ç–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –ë–î?**
A: `du -sh data/postgres/` –∏–ª–∏ –≤–Ω—É—Ç—Ä–∏ –ë–î: `SELECT pg_size_pretty(pg_database_size('fitbud_bot'));`

**Q: –ù—É–∂–Ω–æ –ª–∏ –±—ç–∫–∞–ø–∏—Ç—å –º–µ–¥–∏–∞-—Ñ–∞–π–ª—ã?**
A: –ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —Ç.–∫. —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã AI –∞–Ω–∞–ª–∏–∑–∞ —É–∂–µ –≤ –ë–î. –ù–æ –º–æ–∂–Ω–æ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏.

**Q: –ú–æ–∂–Ω–æ –ª–∏ —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –≥–æ–ª–æ—Å–æ–≤—ã–µ/—Ñ–æ—Ç–æ?**
A: –î–∞, –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª—è—Ç—å —Ñ–∞–π–ª—ã —Å—Ç–∞—Ä—à–µ 30-60 –¥–Ω–µ–π.

**Q: –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–≥–∏ –±–æ—Ç–∞?**
A: –í Docker: `docker compose logs bot`. –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª.

---

**–í–∞–∂–Ω–æ:** –†–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø—ã –ë–î! –û—Å–æ–±–µ–Ω–Ω–æ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏.
